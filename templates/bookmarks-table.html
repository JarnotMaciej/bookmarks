<div class="row justify-content-center">
    <div class="col-auto">
        <h3 class="m-4" style="font-weight: normal">Bookmarks
        </h3>
    </div>
</div>
<table class="table table-hover">
    <caption>All your bookmarks are here!</caption>
    <thead>
        <tr>
            <th scope="col">Website</th>
            <th scope="col">Tags</th>
            <th scope="col">Visited</th>
            <th scope="col">Edit</th>
        </tr>
    </thead>
    <tbody class="table-group-divider">
        {% for document in bookmarks %}
        <tr>
            <td><a href="https://{{ document.url }}" class="text-primary-emphasis" target="_blank">{{ document.name
                    }}</a></td>
            <td>
                {% for tag in document.tags %}
                <span class="badge rounded-pill" style="background-color: #{{ tag.color }}; font-weight: normal;">{{
                    tag.name }}</span>
                {% endfor %}
            </td>
            <td>
                {% if document.visited %}
                <span class="badge text-bg-success" style="font-weight: normal;">Yes</span>
                {% else %}
                <span class="badge text-bg-danger" style="font-weight: normal;">No</span>
                {% endif %}
            </td>
            <td>
                <a href="#" class="editButton">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        class="bi bi-gear-fill text-secondary" viewBox="0 0 16 16" data-bs-toggle="modal"
                        data-bs-target="#editBookmarks">
                        <path
                            d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z" />
                    </svg>
                </a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Modal -->
<div class="modal fade" id="editBookmarks" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel" style="font-weight: normal;"><i><span
                            id="boomarkNameTitle"></span></i>
                </h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body justify-content-center" id="modal-to-edit">
                <form class="align-items-center" method="POST">
                    <div class="row g-3 justify-content-center">
                        <div class="col-auto">
                            <label for="bookmarkName" class="form-label">
                                <h5 style="font-weight: normal;">Change name and URL of the bookmark</h5>
                            </label>
                        </div>
                    </div>
                    <div class="row g-3 justify-content-center">
                        <div class="col-auto">
                            <input type="text" class="form-control form-control-lg m-2" id="editBookmarkName"
                                name="editBookmarkName" placeholder="Bookmark name">
                        </div>
                    </div>
                    <div class="row g-3 justify-content-center">
                        <div class="col-auto">
                            <input type="text" class="form-control form-control-lg m-2" id="editBookmarkURL"
                                name="editBookmarkURL" placeholder="Bookmark URL">
                        </div>
                    </div>
                    <div class="row g-3 justify-content-center">
                        <div class="col-auto">
                            <h5 class="m-2" style="font-weight: normal;">Change tags of the bookmark</h5>
                        </div>
                        <div class="col-auto">
                            {% for tag in editTags %}
                            <span class="badge rounded-pill m-1 editTagBadge"
                                style="background-color: #{{ tag.color }}; font-weight: normal;">{{
                                tag.name }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="row g-3 m-2 justify-content-center">
                        <div class="col-auto">
                            <h6 style="font-weight: normal;">Bookmark name or URL cannot be a duplicate.</h6>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-danger">Delete Bookmark</button>
                <button type="button" class="btn btn-primary">Save Changes</button>
            </div>
        </div>
    </div>
</div>


<script>
    // edit conent of boomarkNameTitle according to the click of editButton

    function assignToModal() {
        let bookmarkNameTitle = document.getElementById("boomarkNameTitle");
        let editButtons = document.getElementsByClassName("editButton");
        let editBookmarkName = document.getElementById("editBookmarkName");
        let editBookmarkURL = document.getElementById("editBookmarkURL");
        let editTagBadges = document.getElementsByClassName("editTagBadge");


        for (let i = 0; i < editButtons.length; i++) {
            editButtons[i].addEventListener("click", function () {
                bookmarkNameTitle.innerHTML = this.parentNode.parentNode.childNodes[1].textContent;

                //values of the input fields are set to the current values of the bookmark
                editBookmarkName.value = this.parentNode.parentNode.childNodes[1].textContent;

                let innerHTML = this.parentNode.parentNode.childNodes[1].innerHTML;
                let url = innerHTML.match(/href="https?:\/\/([^"]+)"/)[1];
                let urlWithoutProtocol = url.replace(/^https?:\/\//, ''); editBookmarkURL.value = url;

                console.log(this.parentNode.parentNode.childNodes[3]);
                badges = this.parentNode.parentNode.childNodes[3].getElementsByClassName("badge");

                // get text inside the badges
                let tags = [];
                for (let i = 0; i < badges.length; i++) {
                    tags.push(badges[i].textContent);
                }

                console.log(tags);

                // this is fucked up
                for (let i = 0; i < editTagBadges.length; i++) {
                    if (tags.includes(editTagBadges[i].textContent)) {
                        editTagBadges[i].classList.add("editTagBadgeChecked");
                        editTagBadges[i].classList.remove("editTagBadge");
                        console.log(editTagBadges[i].textContent, "in tags");
                    } else {
                        editTagBadges[i].classList.remove("editTagBadgeChecked");
                        editTagBadges[i].classList.add("editTagBadge");
                        console.log(editTagBadges[i].textContent, "not in tags");
                    }
                }
            });
        }

    }

    assignToModal();
</script>